---
---

<div class="theme-select" id="theme-select">
	<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 20 20" class="theme-select__icon">
		<path
			fill="currentColor"
			d="M10 3.5a6.5 6.5 0 1 1 0 13zM10 2a8 8 0 1 0 0 16a8 8 0 0 0 0-16"
		></path>
	</svg>
	<label for="theme-selector" class="sr-only">Select a theme:</label>
	<select name="theme-selector" id="theme-selector" class="theme-select__control">
		<option value="system">System</option>
		<option value="dark">Dark</option>
		<option value="light">Light</option>
	</select>
</div>

<style>
	.theme-select {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: fit-content;
		border-radius: 0.5rem;
		border: 1px solid rgba(148, 163, 184, 0.35);
		background: rgba(248, 250, 252, 1);
		padding-left: 0.5rem;
		font-size: 0.85rem;
		font-weight: 600;
		color: rgba(15, 23, 42, 1);
		transition: border-color 0.2s ease, background-color 0.2s ease;
	}

	:global([data-theme='dark']) .theme-select {
		background: rgba(30, 41, 59, 1);
		color: rgba(226, 232, 240, 1);
		border-color: rgba(148, 163, 184, 0.25);
	}

	.theme-select__icon {
		width: 0.9rem;
		height: 0.9rem;
		margin-right: 0.5rem;
	}

	.theme-select__control {
		appearance: none;
		cursor: pointer;
		border: 0;
		border-radius: 0.5rem;
		padding: 0.45rem 0.75rem 0.45rem 0.5rem;
		background: transparent;
		color: inherit;
		font: inherit;
		line-height: 1;
	}

	.theme-select__control:focus {
		outline: none;
		box-shadow: none;
	}

	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}
</style>

<script is:inline>
	const STORAGE_KEY = 'theme';

	function getSavedTheme() {
		return localStorage.getItem(STORAGE_KEY) || 'system';
	}

	function applyTheme(theme) {
		if (theme === 'dark' || theme === 'light') {
			document.documentElement.setAttribute('data-theme', theme);
			return;
		}

		const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
		document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
	}

	function initThemeSelect() {
		const select = document.getElementById('theme-selector');
		if (!select) return;
		if (select.dataset.initialized === 'true') return;
		select.dataset.initialized = 'true';

		const saved = getSavedTheme();
		select.value = saved;
		applyTheme(saved);

		select.addEventListener('change', (event) => {
			const next = event.target.value;
			localStorage.setItem(STORAGE_KEY, next);
			applyTheme(next);
		});

		if (window.matchMedia) {
			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
				if (getSavedTheme() === 'system') applyTheme('system');
			});
		}
	}

	document.addEventListener('DOMContentLoaded', initThemeSelect);
	document.addEventListener('astro:page-load', initThemeSelect);
</script>
